<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<section>
    <h4 class="page-title" th:text="'Продукт #' + ${p.productId()}"></h4>

    <div class="card card-body mb-3">
        <div><b>Название:</b> <span th:text="${p.name()}"></span></div>
        <div><b>Статус:</b> <span class="badge bg-secondary" th:text="${p.status()}"></span></div>
        <div><b>Зона:</b> <span th:text="${p.zoneName()}"></span></div>
        <div><b>Срок:</b> <span th:text="${p.expiresAt()}"></span></div>
        <div><b>Locked:</b> <span th:text="${p.locked()}"></span></div>
    </div>

    <div class="row g-3">
        <div class="col-md-4">
            <div class="card card-body">
                <h6>Переместить</h6>
                <form th:action="@{/products/{id}/move(id=${p.productId()})}" method="post" th:object="${moveForm}">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input class="form-control form-control-sm mb-2" th:field="*{toZoneId}" placeholder="toZoneId">
                    <input class="form-control form-control-sm mb-2" th:field="*{comment}" placeholder="комментарий">
                    <button class="btn btn-sm btn-primary" type="submit">MOVE</button>
                </form>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card card-body">
                <h6>Продлить срок</h6>
                <form th:action="@{/products/{id}/extend(id=${p.productId()})}" method="post" th:object="${extendForm}">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input class="form-control form-control-sm mb-2" th:field="*{newExpiresAt}" placeholder="2026-01-10T12:00:00+01:00">
                    <input class="form-control form-control-sm mb-2" th:field="*{comment}" placeholder="обоснование">
                    <button class="btn btn-sm btn-warning" type="submit">EXTEND</button>
                </form>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card card-body">
                <h6>Статус</h6>
                <form th:action="@{/products/{id}/status(id=${p.productId()})}" method="post" th:object="${statusForm}">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <select class="form-select form-select-sm mb-2" th:field="*{status}">
                        <option value="EATEN">EATEN</option>
                        <option value="TAKEN">TAKEN</option>
                        <option value="DISPOSED">DISPOSED</option>
                        <option value="EXPIRED">EXPIRED</option>
                        <option value="ACTIVE">ACTIVE</option>
                    </select>
                    <input class="form-control form-control-sm mb-2" th:field="*{comment}" placeholder="комментарий">
                    <button class="btn btn-sm btn-danger" type="submit">SET</button>
                </form>
            </div>
        </div>
    </div>

    <h5 class="mt-4">История</h5>
    <table class="table table-sm table-striped">
        <thead>
        <tr><th>Когда</th><th>Тип</th><th>Комментарий</th></tr>
        </thead>
        <tbody>
        <tr th:each="h : ${p.history()}">
            <td th:text="${h.createdAt}"></td>
            <td th:text="${h.eventType}"></td>
            <td th:text="${h.comment}"></td>
        </tr>
        </tbody>
    </table>
</section>
</html>

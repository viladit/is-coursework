<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::section})}">
<section>
    <h4 class="page-title mb-3">Пользователи</h4>

    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <div class="card">
        <div class="card-body p-0">
            <table class="table table-hover align-middle mb-0">
                <thead>
                <tr>
                    <th>Email</th>
                    <th>Имя</th>
                    <th>Комната</th>
                    <th>Роли</th>
                    <th>Blocked</th>
                    <th class="text-end">Действия</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="u : ${users}">
                    <td th:text="${u.email}">email</td>
                    <td th:text="${u.name}">name</td>
                    <td th:text="${u.room}">room</td>
                    <td>
                        <span class="badge bg-secondary me-1" th:each="r : ${u.roles}" th:text="${r.code}">ROLE</span>
                    </td>
                    <td>
                        <span class="text-danger" th:if="${u.blockedAt != null}">Blocked</span>
                        <span class="text-muted" th:if="${u.blockedAt == null}">Active</span>
                    </td>
                    <td class="text-end">
                        <div class="d-inline-flex flex-wrap gap-2">
                            <form th:if="${u.blockedAt == null}" th:action="@{/admin/users/{id}/block(id=${u.userId})}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-outline-danger btn-sm" type="submit">Block</button>
                            </form>
                            <form th:if="${u.blockedAt != null}" th:action="@{/admin/users/{id}/unblock(id=${u.userId})}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-outline-success btn-sm" type="submit">Unblock</button>
                            </form>
                            <form th:action="@{/admin/users/{id}/roles/MODERATOR/grant(id=${u.userId})}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-outline-primary btn-sm" type="submit">+MOD</button>
                            </form>
                            <form th:action="@{/admin/users/{id}/roles/MODERATOR/revoke(id=${u.userId})}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-outline-secondary btn-sm" type="submit">-MOD</button>
                            </form>
                            <form th:action="@{/admin/users/{id}/roles/ADMIN/grant(id=${u.userId})}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-outline-primary btn-sm" type="submit">+ADMIN</button>
                            </form>
                            <form th:action="@{/admin/users/{id}/roles/ADMIN/revoke(id=${u.userId})}" method="post">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-outline-secondary btn-sm" type="submit">-ADMIN</button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>
</html>
